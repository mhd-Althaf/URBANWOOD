<script>
            // Function to handle address selection
            document.querySelectorAll('.address-radio').forEach(radio => {
                radio.addEventListener('change', function () {
                    const addressId = this.value;
                    // console.log('Selected address ID:', addressId);

                    // Remove active class from all cards
                    document.querySelectorAll('.address-card').forEach(card => {
                        card.classList.remove('active-card');
                    });

                    // Add active class to selected card
                    this.closest('.address-card').classList.add('active-card');
                });
            });

            // Function to edit address
            function editAddress(addressId) {
                // console.log('Edit address:', addressId);
                // Add your edit logic here
                // Example: window.location.href = `/edit-address/${addressId}`;
            }

            // Function to delete address
            function deleteAddress(addressId) {
                if (confirm('Are you sure you want to delete this address?')) {
                    // console.log('Delete address:', addressId);
                    // Add your delete logic here
                    // Example: 
                    // fetch(`/delete-address/${addressId}`, {
                    //     method: 'DELETE'
                    // }).then(response => {
                    //     if (response.ok) {
                    //         window.location.reload();
                    //     }
                    // });
                }
            }



            async function placeOrder(userId, productId) {
                let address = $("input[name='selectedAddress']:checked").val();
                let payment = $("input[name='payment_option']:checked").val();


                const sum = document.getElementById("totalValue").textContent;
                const numericValue = parseInt(sum.replace(/[^\d.]/g, ''));
                console.log(numericValue);


                if (!payment) {
                    Swal.fire({
                        title: 'NO PAYMENT FOUND!',
                        text: 'Please select your Payment.',
                        icon: 'error',
                        timer: 3000,
                    });
                } else if (!address) {
                    Swal.fire({
                        title: 'NO ADDRESS FOUND!',
                        text: 'Please select your address.',
                        icon: 'error',
                        timer: 3000,
                    });
                } else if (payment === "cod" && numericValue > 1000) {
                    Swal.fire({
                        title: 'COD Not Allowed!',
                        text: 'Orders above ₹1000 are not allowed for Cash on Delivery (COD).',
                        icon: 'error',
                        timer: 3000,
                    });
                } else {
                    $.ajax({
                        url: '/orderPlaced',
                        method: 'POST',
                        data: {
                            totalPrice: numericValue,
                            createdOn: new Date().getTime(),
                            date: new Date(),
                            addressId: address,
                            payment: payment,
                            discount: discount
                        },
                        success: function (response) {
                            let orderId = response.order._id
                            if (response.method === "cod") {
                                console.log("cod")
                                Swal.fire({
                                    title: "Order success",
                                    text: "order placed successfully",
                                    icon: "success",
                                    showCancelButton: true,
                                    confirmButtonText: "view orders",
                                    cancelButtonText: "continue shopping",
                                    reverseButtons: true
                                }).then(function (result) {
                                    if (result.value) {
                                        let orderId = response.order._id
                                        location.href = `/orderDetails?id=${orderId}`;
                                    } else if (result.dismiss === "cancel") {
                                        location.href = '/'
                                    }
                                });

                            } else if (response.method === "wallet") {
                                if (response.payment === true) {
                                    Swal.fire({
                                        title: "Order success",
                                        text: "order placed successfully",
                                        icon: "success",
                                        showCancelButton: true,
                                        confirmButtonText: "view orders",
                                        cancelButtonText: "continue shopping",
                                        reverseButtons: true
                                    }).then(function (result) {
                                        if (result.value) {
                                            let orderId = response.order._id
                                            location.href = `/orderDetails?id=${orderId}`;
                                        } else if (result.dismiss === "cancel") {
                                            location.href = '/'
                                        }
                                    });
                                } else {
                                    Swal.fire({
                                        title: "Order failed",
                                        text: "Wallet amount is not enough",
                                        icon: "error",
                                        showConfirmButton: true,
                                    }).then(function (result) {
                                        if (result.value) {
                                            location.href = '/';
                                        }
                                    });
                                }

                            }
                            else if (response.method === "Razorpay") {
                                console.log("nii");
                                let orderAmount = Math.round(numericValue * 100);
                                var options = {
                                    "key": "rzp_test_FQC7rcsIS35ORI",
                                    "amount": orderAmount,
                                    "currency": "INR",
                                    "name": "Trend Setter",
                                    "description": "Test Transaction",
                                    "image": "https://firebasestorage.googleapis.com/v0/b/ecommerce-397a7.appspot.com/o/logo.jpg?alt=media&token=07b6be19-1ce8-4797-a3a0-f0eaeaafedad",
                                    "order_id": response.razorPayOrder.id,
                                    "handler": function (status) {
                                        verifyPayment(response.razorPayOrder, status, response.order._id);
                                    },
                                    "prefill": {
                                        "name": "Customer Name",
                                        "email": "customer@example.com",
                                        "contact": "9961618585"
                                    },

                                    "theme": {
                                        "color": "#3399cc"
                                    }
                                }
                                var rzp1 = new Razorpay(options);
                                rzp1.open();

                            } else {
                                Swal.fire({
                                    title: 'Error Occured',
                                    text: "Can't process order error occured",
                                    icon: 'fail',
                                    timer: 5000
                                })
                            }
                        },
                    });
                }
            }

            function verifyPayment(order, payment, orderId) {
                $.ajax({
                    url: '/verifyPayment',
                    method: 'post',
                    data: {
                        order,
                        payment
                    }, success: (response) => {
                        if (response.status) {
                            $.ajax({
                                url: '/paymentConfirm',
                                method: 'post',
                                data: {
                                    status: "Pending",
                                    orderId
                                },
                                success: (response) => {
                                }
                            })
                            Swal.fire({
                                title: "Order success",
                                text: "order placed successfully",
                                icon: "success",
                                showCancelButton: true,
                                confirmButtonText: "view orders",
                                cancelButtonText: "continue shopping",
                                reverseButtons: true
                            }).then(function (result) {
                                if (result.value) {
                                    console.log("I am success");
                                    var orderDetailsUrl = `/orderDetails?id=${orderId}`;
                                    location.href = orderDetailsUrl;
                                } else if (result.dismiss === "cancel") {
                                    console.log("Nopppp");
                                    location.href = '/'
                                }
                            });
                        }

                    }
                })
            }

            function showCouponDetails(couponName) {
                Swal.fire({
                    title: 'Coupon Details',
                    text: `${couponName}`,
                    icon: 'info',
                    confirmButtonText: 'OK'
                }).then((result) => {
                    if (result.isConfirmed) {
                        copyToClipboard(couponName);
                    }
                });
            }

            function copyToClipboard(text) {
                var tempInput = document.createElement('input');
                document.body.appendChild(tempInput);
                tempInput.value = text;

                tempInput.select();
                document.execCommand('copy');

                document.body.removeChild(tempInput);

                Swal.fire({
                    title: 'Copied!',
                    text: 'Coupon name has been copied to the clipboard.',
                    icon: 'success',
                    confirmButtonText: 'OK'
                });
            }

            let discount = 0;



            const applyCoupon = async (totalAmount) => {
                const couponName = document.getElementById("inputCoupon").value.trim();
                if (!couponName) {
                    Swal.fire({ icon: 'error', title: 'Error', text: 'Please enter a coupon code.' });
                    return;
                }

                try {
                    const response = await fetch('/applyCoupon', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ coupon: couponName, total: totalAmount }),
                    });

                    const data = await response.json();
                    if (data.success) {
                        Swal.fire({ icon: 'success', title: 'Success', text: `Coupon Discount ${data.offerPrice} Applied` });
                        document.getElementById("totalValue").innerText = `₹${data.gt}`;
                        document.getElementById("discount").innerText = data.offerPrice;
                        document.getElementById("inputCoupon").value = "";
                        discount = data.offerPrice;
                    } else {
                        Swal.fire({ icon: 'error', title: 'Error', text: data.message });
                    }
                } catch (error) {
                    console.error('Error applying coupon:', error);
                    Swal.fire({ icon: 'error', title: 'Error', text: 'Failed to apply coupon.' });
                }
            };




            var usedCoupon = null;
            const useCoupon = async (couponName) => {
                disableOtherCoupons(couponName);
                copyToClipboard(couponName);
                document.getElementById("inputCoupon").value = couponName;
                document.getElementById('useButton_' + couponName).style.display = 'none';
                document.getElementById('cancelButton_' + couponName).style.display = 'block';
                usedCoupon = couponName;
            }

            const cancelCoupon = async (couponName) => {
                enableAllCoupons();
                document.getElementById('useButton_' + couponName).style.display = 'block';
                document.getElementById('cancelButton_' + couponName).style.display = 'none';
                usedCoupon = null;
                window.location.reload();
            }
            function disableOtherCoupons(excludeCoupon) {
                var couponButtons = document.querySelectorAll('.use-button');
                couponButtons.forEach(function (button) {
                    var couponName = button.id.replace('useButton_', '');
                    if (couponName !== excludeCoupon) {
                        button.disabled = true;
                    }
                });
            }

            function enableAllCoupons() {
                var couponButtons = document.querySelectorAll('.use-button');
                couponButtons.forEach(function (button) {
                    button.disabled = false;
                });
            }
        </script>