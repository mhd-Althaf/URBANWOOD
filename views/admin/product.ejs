<%-include("../../views/partials/admin/header")%>
<div class="main-panel">
    
    <div class="card-body">
        <div class="table-responsive">
            <table class="table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Category</th>
                        <th>RegPrice</th>
                        <th>OfferPrice</th>
                        <th>Quantity</th>
                        <th>Update</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody>
                    <% data.forEach(product => { %>
                        <tr>
                            <td><%= product.productName %></td>
                            <td><%= product.category.name %></td>
                            <td><%= product.regularPrice %></td>
                            <td><%= product.salePrice %></td>
                            <td><%= product.quantity %></td>
                            <td>
                                <% if (product.isBlocked === false) { %>
                                    <button class="btn btn-danger" onclick="toggleBlock('<%= product._id %>', 'block')" style="width: 80px;">
                                        Block
                                    </button>
                                <% } else { %>
                                    <button class="btn btn-success" onclick="toggleBlock('<%= product._id %>', 'unblock')" style="width: 80px;">
                                        Unblock
                                    </button>
                                <% } %>
                            </td>
                            <td>
                                <button class="btn btn-info" style="width: 80px;">
                                    <a href="/admin/editProduct/<%= product._id %>" class="text-white" style="text-decoration: none;">Edit</a>
                                </button>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
            <a href="/admin/addProducts"> <button>Add Product</button></a>

            <div class="pagination-container text-center mt-4">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-center">
                        <% if (currentPage > 1) { %>
                            <li class="page-item">
                                <a class="page-link" href="?page=<%= currentPage - 1 %>&search=<%= search %>" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                        <% } else { %>
                            <li class="page-item disabled">
                                <span class="page-link" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </span>
                            </li>
                        <% } %>
                        
                        <% for (let i = 1; i <= totalPages; i++) { %>
                            <% if (i === currentPage) { %>
                                <li class="page-item active">
                                    <span class="page-link"><%= i %></span>
                                </li>
                            <% } else { %>
                                <li class="page-item">
                                    <a class="page-link" href="?page=<%= i %>&search=<%= search %>"><%= i %></a>
                                </li>
                            <% } %>
                        <% } %>
                        
                        <% if (currentPage < totalPages) { %>
                            <li class="page-item">
                                <a class="page-link" href="?page=<%= currentPage + 1 %>&search=<%= search %>" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        <% } else { %>
                            <li class="page-item disabled">
                                <span class="page-link" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </span>
                            </li>
                        <% } %>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/assets/vendors/js/vendor.bundle.base.js"></script>
<script src="/assets/js/dashboard.js"></script>
<script src="/assets/js/off-canvas.js"></script>
<script src="/assets/js/hoverable-collapse.js"></script>
<script src="/assets/js/misc.js"></script>
<script src="/assets/js/settings.js"></script>
<script src="/assets/js/todolist.js"></script>
<script>
    function toggleBlock(productId, action) {
        const url = action === 'block' ? '/blockProduct' : '/unblockProduct';
        const method = 'POST';
   console.log("blaa",url)
        fetch(url, {
            method: method,
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ productId: productId }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.status) {
                Swal.fire({
                    icon: 'success',
                    title: data.message,
                    showConfirmButton: false,
                    timer: 1500
                }).then(() => {
                    window.location.reload();  // Refresh page
                });
            } else {
                Swal.fire({
                    icon: 'error',
                    title: data.message,
                    showConfirmButton: true
                });
            }
        })
        .catch(error => {
            console.error("Error:", error);
            Swal.fire({
                icon: 'error',
                title: 'Something went wrong!',
                text: error.message,
                showConfirmButton: true
            });
        });
    }
</script>
</body>
</html>
